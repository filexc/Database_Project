<!DOCTYPE html>
<html>
<style>
    .item {
        /* float: left; */
        margin: 2px;
        background-color: lightcoral;
        line-height: 100px;
        text-align: center;
        margin: 2px;
        /* display: block; */
        /* width: 100px; */
    }

    .container {
        margin-top: 20px;
        overflow: hidden;
    }

    /* Style the buttons */
    .button {
        border: none;
        outline: none;
        padding: 12px 16px;
        background-color: #f1f1f1;
        cursor: pointer;
    }

    .button:hover {
        background-color: #ddd;
    }

    .button.active {
        background-color: #666;
        color: white;
    }
</style>

<body>

    <h2>Databases</h2>

    <div class="filters">
        <button data-filter="all">All</button>
    </div>

    <div class="container">
    </div>

    <script>
        const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSKC0N3BXrvxSnYhKoLtg1AG7QKevRWw6wtglOxOqd5c2yA-4sYm1fa51Q5thYUbNmvuUhgwogaZacG/pub?output=tsv';
        fetch(sheetUrl)
            .then(response => response.text())
            .then(csvData => {
                const lines = csvData.trim().split('\n');
                const headers = lines[0].split('\t');

                const container = document.querySelector('.container');
                const filters = new Set();  // To hold unique tags

                // Create items and collect tags
                for (let i = 1; i < lines.length; i++) {
                    const parts = lines[i].split('\t');
                    const name = parts[0];
                    const tags = parts.slice(1);

                    const div = document.createElement('div');
                    div.className = 'item';
                    div.dataset.tags = tags.join(',');
                    div.textContent = name;

                    container.appendChild(div);

                    // Add tags to the filters Set (avoiding duplicates)
                    tags.forEach(tag => 
                        {const cleanTag = tag.trim()
                            .replace(/\s+/g, ' ')           // collapse multiple spaces
                            .replace(/\u00A0/g, ' ')        // replace non-breaking spaces; 
                        if (cleanTag != ""){
                            filters.add(cleanTag)
                        }
                    }
                    );

                    sortedFilters = Array.from(filters).sort();
                }

                // Dynamically create filter buttons based on unique tags
                const filtersContainer = document.querySelector('.filters');

                sortedFilters.forEach(tag => {
                    const button = document.createElement('button');
                    button.dataset.filter = tag;
                    button.textContent = tag;
                    filtersContainer.appendChild(button);

                    // Add filter functionality to each button
                    button.addEventListener('click', () => {
                        const filter = button.dataset.filter;
                        document.querySelectorAll('.item').forEach(item => {
                            if (filter === 'all' || item.dataset.tags.includes(filter)) {
                                item.style.display = 'block';
                            } else {
                                item.style.display = 'none';
                            }
                        });

                        // Highlight active button
                        document.querySelectorAll('.filters button').forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                    });
                });

                // Add the 'all' filter functionality
                const allButton = document.querySelector('[data-filter="all"]');
                allButton.addEventListener('click', () => {
                    document.querySelectorAll('.item').forEach(item => {
                        item.style.display = 'block';
                    });

                    // Highlight active button
                    document.querySelectorAll('.filters button').forEach(btn => btn.classList.remove('active'));
                    allButton.classList.add('active');
                });

            })
            .catch(error => {
                console.error('Error loading the sheet:', error);
            });
    </script>

</body>

</html>